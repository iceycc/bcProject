webpackJsonp([30],{"V/he":function(t,e){},ZBbx:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("EOwk"),i=a("MmTA"),o=a("0jG4"),n=void 0,r={data:function(){return{proDetail:{},APPLY_AMOUNT:null,payNum:"1000",agree:!0,imgSrc:s.g,INCRE_AMOUNT:"",msgCode:"",msgdisable:!1,codeText:"获取验证码"}},computed:{placeholder:function(){return(this.proDetail.MIN_AMOUNT||"0")+"元起购"},ifCheckMoneyEmpty:function(){return!this.APPLY_AMOUNT},canClick:function(){return!!(this.APPLY_AMOUNT&&this.msgCode&&this.agree)}},mixins:[a("msXN").a.StoreMixin],created:function(){this.getInfo(),this.proDetail=this.getComState.goBuy,console.log(this.proDetail)},methods:{clearNumHandle:function(){this.APPLY_AMOUNT=""},getInfo:function(){var t=this;o.a.bank.apiQryEleAccount({},function(e){console.log(e),t.payNum=e.ACC_REST||1e3})},goReChang:function(){this.setComState({type:"OriginPage",value:this.$route.fullPath}),this.$router.push({name:s.e.Recharge})},getAgreement:function(t){this.agree=!0,this.$router.push({name:s.e.DocsPage,query:{type:t}})},checkAPPLY_AMOUNT:function(t){var e=this.proDetail.INCRE_AMOUNT;return t<parseInt(this.proDetail.MIN_AMOUNT)?(i.a.$emit(s.a.showToast,"投资金额小于起投金额，请调整投资金额"),!0):t%e!=0&&(i.a.$emit(s.a.showToast,"请输入递增金额的整数倍"),!0)},goBuy:function(){var t=this;this.agree?this.APPLY_AMOUNT?"number"!=typeof(this.APPLY_AMOUNT-0)||isNaN(this.APPLY_AMOUNT-0)?i.a.$emit(s.a.showToast,"请填写正确的金额"):this.APPLY_AMOUNT-0>this.payNum?i.a.$emit(s.a.showToast,"余额不足，请充值"):this.checkAPPLY_AMOUNT(this.APPLY_AMOUNT)||(this.APPLY_AMOUNT-0>this.REMAIN_AMT?i.a.$emit(s.a.showToast,"可投额度不足"):(this.Londing.open({spinnerType:"triple-bounce"}),setTimeout(function(){t.Londing.close()},500),this.doPay())):i.a.$emit(s.a.showToast,"请输入购买金额"):i.a.$emit(s.a.showToast,"请同意相关协议")},getCode:function(){var t=this.getComState.TEL,e={PHONE_NUM:t,BIZ_TYPE:"1008",AMOUNT:this.APPLY_AMOUNT};o.a.common.apiSendPhoneCode(e,function(e){i.a.$emit(s.a.showSendMsg,t)})},getMsg:function(){var t=this,e=60;this.msgdisable=!0,n=setInterval(function(){if(0==e)return t.codeText="重新发送",t.msgdisable=!1,void clearInterval(n);e--,t.codeText=e+"s"},1e3),this.getCode()},polling:function(t){var e=this,a={BIZ_TYPE:"6",BESHARP_SEQ:t.BESHARP_ORDER_NO};this.Londing.open({text:"正在购买中"});var n=1,r=setInterval(function(){n++,o.a.common.apiQueryBizStatus(a,function(t){if("1"==t.RES_CODE||5==n)e.Londing.close(),clearInterval(r),i.a.$emit(s.a.showToast,t.RES_MSG),e.$router.push({name:s.e.BuyFailed,query:{err:t.RES_MSG}});else{if("0"==t.RES_CODE)return clearInterval(r),i.a.$emit(s.a.showToast,t.RES_MSG),e.Londing.close(),e.setComState({type:"buyData",value:t}),void e.$router.push({name:s.e.BuySuccess});if(n>5)return clearInterval(r),i.a.$emit(s.a.showToast,t.RES_MSG),void e.$router.push({name:s.e.BuyFailed,query:{err:t.RES_MSG}})}},function(t){clearInterval(r),i.a.$emit(s.a.showToast,t)})},2e3)},doPay:function(){var t=this,e={PRD_ID:(this.proDetail.ID||this.proDetail.PRD_INDEX_ID)+"",TYPE:"API_BUY",APPLY_AMOUNT:this.APPLY_AMOUNT+"",PHONE_CODE:this.msgCode,ACCEPT_RISK:"1"};console.log(e),o.a.buy.apiBuy(e,function(e){t.polling(e)},function(e){t.Londing.close(),t.setComState({type:"reload",value:!0}),t.$router.push({name:s.e.BuyFailed,query:{err:e}})})}}},c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app",attrs:{id:"app"}},[s("app-bar",{attrs:{title:"存入"}}),t._v(" "),s("div",{staticClass:"buytitle"},[s("div",{staticClass:"buytitleleft"},[s("div",{staticClass:"buytitleleftimg"},[s("img",{staticStyle:{width:"100%"},attrs:{src:t.imgSrc+t.proDetail.LOGO_URL,alt:""}})]),t._v(" "),s("div",{staticClass:"buytitleleftcontent"},[s("p",[t._v(t._s(t.proDetail.ORG_NAME))]),t._v(" "),s("p",{staticStyle:{color:"#666"}},[t._v(t._s(t.proDetail.PRD_NAME))])])]),t._v(" "),s("div",{staticClass:"buytitleright"},[s("p",[t._v("起购金额"+t._s(t.proDetail.MIN_AMOUNT)+"元")]),t._v(" "),s("p",[t._v("最小递增"+t._s(t.proDetail.INCRE_AMOUNT)+"元")])])]),t._v(" "),s("div",{staticClass:"buysuccessdetails"},[s("div",{staticClass:"buysuccessdetailleft"},[t._v("可用金额 "),s("strong",[t._v(t._s(t._f("formatNum")(t.payNum))+"元")])]),t._v(" "),s("div",{staticClass:"buysuccessdetailright",on:{click:t.goReChang}},[t._v("充值")])]),t._v(" "),s("div",{staticClass:"buydetails"},[s("p",{staticStyle:{"margin-top":"0.3rem"}},[t._v("存入金额")]),t._v(" "),s("span",{staticClass:"buydetailsmoney"},[t._v("￥")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.APPLY_AMOUNT,expression:"APPLY_AMOUNT"}],attrs:{type:"number",placeholder:t.placeholder},domProps:{value:t.APPLY_AMOUNT},on:{input:function(e){e.target.composing||(t.APPLY_AMOUNT=e.target.value)}}}),t._v(" "),s("img",{directives:[{name:"show",rawName:"v-show",value:!t.ifCheckMoneyEmpty,expression:"!ifCheckMoneyEmpty"}],staticClass:"close-icon",attrs:{src:a("rfOz"),alt:""},on:{click:t.clearNumHandle}})]),t._v(" "),s("section",{staticClass:"inputAmount"},[s("span",{staticClass:"Amount"},[t._v("\n              验证码\n          ")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.msgCode,expression:"msgCode"}],attrs:{type:"tel",placeholder:"输入验证码"},domProps:{value:t.msgCode},on:{input:function(e){e.target.composing||(t.msgCode=e.target.value)}}}),t._v(" "),s("button",{staticClass:"button",attrs:{disabled:t.msgdisable},on:{click:t.getMsg}},[t._v(t._s(t.codeText)+"\n    ")])]),t._v(" "),s("button",{class:{tijiao:!0,active:t.canClick},attrs:{disabled:!t.canClick},on:{click:t.goBuy}},[t._v("存入")]),t._v(" "),s("p",{class:{bang:!0,no:0==t.agree},on:{click:function(e){t.agree=!t.agree}}},[t._v("我已阅读并同意\n    "),s("a",{staticStyle:{color:"#0096FE"},attrs:{href:"javascript:;"},on:{click:function(e){e.stopPropagation(),t.getAgreement("buy")}}},[t._v("《众邦宝产品服务协议（个人活期版）》")])])],1)},staticRenderFns:[]};var l=a("VU/8")(r,c,!1,function(t){a("V/he")},"data-v-b87a5b28",null);e.default=l.exports}});
//# sourceMappingURL=30.9fc9ce0d82f48f2749f3.js.map